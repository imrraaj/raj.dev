---
import PageLayout from "./PageLayout.astro";
const { frontmatter } = Astro.props;

const getUTCdate = (date) => {
  const [day, month, year] = date.split("-").map(Number);
  const inputDateUTC = new Date(Date.UTC(year, month - 1, day));
  return inputDateUTC;
};
const getISTdateString = (date) => {
  const inputDateUTC = getUTCdate(date);
  const istDateString = inputDateUTC.toLocaleDateString("en-US", {
    timeZone: "Asia/Kolkata",
    year: "numeric",
    month: "long",
    day: "2-digit",
  });
  return istDateString;
};

const publishedOn = getISTdateString(frontmatter.date);
---

<PageLayout 
  title={frontmatter.title} 
  description={frontmatter.description}
  canonical={`https://rajpa.tel/blog/${Astro.url.pathname.split('/').pop()}`}
  image={frontmatter.image || "/landscape.jpg"}
>
  <script type="application/ld+json" set:html={JSON.stringify({
    "@context": "https://schema.org",
    "@type": "BlogPosting",
    "headline": frontmatter.title,
    "description": frontmatter.description,
    "author": {
      "@type": "Person",
      "name": "Raj Patel",
      "url": "https://rajpa.tel",
      "sameAs": [
        "https://github.com/imrraaj",
        "https://x.com/imrraaj"
      ]
    },
    "publisher": {
      "@type": "Person",
      "name": "Raj Patel",
      "url": "https://rajpa.tel"
    },
    "datePublished": getUTCdate(frontmatter.date).toISOString(),
    "dateModified": getUTCdate(frontmatter.date).toISOString(),
    "mainEntityOfPage": {
      "@type": "WebPage",
      "@id": `https://rajpa.tel/blog/${Astro.url.pathname.split('/').pop()}`
    },
    "url": `https://rajpa.tel/blog/${Astro.url.pathname.split('/').pop()}`,
    "image": frontmatter.image ? `https://rajpa.tel${frontmatter.image}` : "https://rajpa.tel/landscape.jpg",
    "keywords": frontmatter.tags || "",
    "articleSection": "Blog",
    "inLanguage": "en-US"
  })}/>
  
  <article itemscope itemtype="https://schema.org/BlogPosting">
    <meta itemprop="author" content="Raj Patel" />
    <meta itemprop="datePublished" content={getUTCdate(frontmatter.date).toISOString()} />
    <meta itemprop="dateModified" content={getUTCdate(frontmatter.date).toISOString()} />
    
    <header class="my-4">
      <h1 class="md:text-4xl text-2xl font-black leading-relaxed text-zinc-200" itemprop="headline">
        {frontmatter.title}
      </h1>
      <p class="text-sm font-medium text-zinc-300">
        Published On: <time datetime={getUTCdate(frontmatter.date).toISOString()} itemprop="datePublished">{publishedOn}</time>
      </p>
      {frontmatter.tags && (
        <div class="mt-2">
          <span class="text-xs text-zinc-400">Tags: </span>
          {frontmatter.tags.split(', ').map(tag => (
            <span class="text-xs bg-zinc-800 text-zinc-300 px-2 py-1 rounded mr-1" itemprop="keywords">{tag}</span>
          ))}
        </div>
      )}
    </header>
    <div
      class="prose
      text-md
      text-left
      my-4
      min-w-full
      prose-headings:font-black
      prose-headings:text-zinc-200
      prose-strong:text-emerald-400
      prose-strong:font-bold
      prose-img:rounded-xl
      prose-img:mx-auto
      prose-a:bg-zinc-800/80
      prose-a:px-1
      prose-a:text-zinc-300
      prose-p:text-zinc-100
      prose-blockquote:font-serif
      prose-li:text-zinc-200
      prose-code:text-zinc-200
      prose-code:before:content-['']
      prose-code:after:content-['']
    "
    itemprop="articleBody"
    >
      <slot />
    </div>
  </article>
</PageLayout>
